'use strict';

var dagNodeUtil = require('./util');
var cloneLinks = dagNodeUtil.cloneLinks;
var cloneData = dagNodeUtil.cloneData;
var create = require('./create');

function rmLink(dagNode, nameOrMultihash, callback) {
  var data = cloneData(dagNode);
  var links = cloneLinks(dagNode);

  if (typeof nameOrMultihash === 'string') {
    links = links.filter(function (link) {
      return link.name !== nameOrMultihash;
    });
  } else if (Buffer.isBuffer(nameOrMultihash)) {
    links = links.filter(function (link) {
      return !link.multihash.equals(nameOrMultihash);
    });
  } else {
    return callback(new Error('second arg needs to be a name or multihash'), null);
  }

  create(data, links, callback);
}

module.exports = rmLink;