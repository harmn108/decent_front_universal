'use strict';

var crypto = require('crypto');

var lengths = require('./hmac-lengths');

exports.create = function (hash, secret, callback) {
  var res = {
    digest: function digest(data, cb) {
      var hmac = genFresh();
      hmac.update(data);

      setImmediate(function () {
        cb(null, hmac.digest());
      });
    },

    length: lengths[hash]
  };

  function genFresh() {
    return crypto.createHmac(hash.toLowerCase(), secret);
  }
  callback(null, res);
};