'use strict';

var promisify = require('promisify-es6');
var cleanCID = require('../clean-cid');
var v = require('is-ipfs');

module.exports = function (send) {
  return promisify(function (hash, opts, callback) {
    if (typeof opts === 'function') {
      callback = opts;
      opts = {};
    }

    try {
      hash = cleanCID(hash);
    } catch (err) {
      if (!v.ipfsPath(hash)) {
        return callback(err);
      }
    }

    send({
      path: 'cat',
      args: hash,
      buffer: opts.buffer
    }, callback);
  });
};