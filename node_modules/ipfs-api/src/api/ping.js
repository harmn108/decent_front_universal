'use strict';

var promisify = require('promisify-es6');
var streamToValue = require('../stream-to-value');

module.exports = function (send) {
  return promisify(function (id, callback) {
    var request = {
      path: 'ping',
      args: id,
      qs: { n: 1 }

      // Transform the response stream to a value:
      // { Success: <boolean>, Time: <number>, Text: <string> }
    };var transform = function transform(res, callback) {
      streamToValue(res, function (err, res) {
        if (err) {
          return callback(err);
        }

        // go-ipfs http api currently returns 3 lines for a ping.
        // they're a little messed, so take the correct values from each lines.
        var pingResult = {
          Success: res[1].Success,
          Time: res[1].Time,
          Text: res[2].Text
        };

        callback(null, pingResult);
      });
    };

    send.andTransform(request, transform, callback);
  });
};