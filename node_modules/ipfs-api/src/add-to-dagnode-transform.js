'use strict';

var map = require('async/map');
var waterfall = require('async/waterfall');

var getDagNode = require('./get-dagnode');

// transform { Hash: '...' } objects into { path: 'string', node: DAGNode }
module.exports = function (err, res, send, done) {
  if (err) {
    return done(err);
  }

  map(res, function (entry, next) {
    return waterfall([function (cb) {
      return getDagNode(send, entry.Hash, cb);
    }, function (node, cb) {
      if (err) {
        return cb(err);
      }

      cb(null, {
        path: entry.Name,
        hash: entry.Hash,
        size: node.size
      });
    }], next);
  }, done);
};